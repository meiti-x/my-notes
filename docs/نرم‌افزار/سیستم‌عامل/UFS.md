---
title: Union File System
tags:
  - os
  - docker
description: ุชูุถุญ ูุญูู ฺฉุงุฑฺฉุฑุฏ ูุงู ุณุณุชู ูุงู ุง ูููฺฉุณ
---

![UFS](/img/ufs2.png)

ุง**Union File System** (ุง UnionFS) ู ุชฺฉูฺฉ ุชู ูุงูโุณุณุชูโูุงุณุช ฺฉู ุจูุช ุงุฌุงุฒู ูโุฏู **ฺูุฏ ุชุง ูุงูโุณุณุชู ุฌุฏุง ุฑู ุจู ุดฺฉู ู ูุงูโุณุณุชู ฺฉูพุงุฑฺู ุจุจู ู ุงุณุชูุงุฏู ฺฉู.**

ุจู ุฌุง ุงูฺฉู ูููโฺุฒู ุชู ู ุฌุง ุจุฑุฒูุ ูุงุฏ ฺูุฏ ุชุง ยซูุงูยป (layer) ูโุณุงุฒู ฺฉู ูุฑฺฉุฏูู ููุท ุชุบุฑุงุช ูุฑุจูุท ุจู ุฎูุฏุดููู ุฏุงุฑูุ ู ุงู ูุงูโูุง ุฑู ุจุง ูู ยซุชุฑฺฉุจยป ูโฺฉูู ุชุง ุงูฺฏุงุฑ ู ุณุงุฎุชุงุฑ ููุณุฌู ุฏุงุฑ.

:::tip

ูุซู ููุดู ุฏุงฺฉุฑ ุฏุฑ ุฏูุง ูููฺฉุณ ฺุฒ ุฌุฏุฏ ุงุฎุชุฑุงุน ูฺฉุฑุฏู ูุง ูุจูุง ูู ufs ุฑู ุฏุงุดุชู

ูุซูุง ุงูุจููุชููุง Live:

- ูุงูโุณุณุชู ุงุตู ุจูโุตูุฑุช read-only ุชู CD ุง ISO ูุณุช
- ู ูุงูโ writable (tmpfs ุง ramfs) ุฑูุด ุณูุงุฑ ูโุดู
- ฺฉุงุฑุจุฑ ุงูฺฏุงุฑ ุฏุงุฑู ุฑู ู ุณุณุชู ฺฉุงูู ฺฉุงุฑ ูโฺฉูู
- ูู ูฺ ูุงู ูุงูุนุงู ุชู ุฏุณฺฉ ููุดุชู ููโุดู (ฺูู CD ุง ISO ููุท ุฎููุฏูู)

๐ ุงู ุฏููุงู ูููู ููุณููโ **UFSู**: base image read-only + ู ูุงูโ ูุงุจู ููุดุชู ูููุช.

:::

:::note

tmpfs ู ูุงูโุณุณุชู ูููุชู ฺฉู ูุงูโูุงุด ุฑู ุชู ุฑู ุฐุฎุฑู ูโฺฉููุ ุนู ุฎู ุณุฑุนุ ูู ููู ฺุฒ ุจุง ุฎุงููุด ฺฉุฑุฏู ุณุณุชู ูพุงฺฉ ูโุดู.

ูุซุงู ููููุณุด ูููู ูุณุฑ /tmp ูุณุช ฺฉู ูุนูููุง ุฑู tmpfs ูุฑุงุฑ ุฏุงุฑู ู ูุงุณู ูุงูโูุง ูููุช ุงุณุชูุงุฏู ูโุดู.

ุจุฑุง ุฏุชุงูุง ุจุง persistance ูู ูุชููู ุงุฒ bind mounts ุง volume ุงุณุชูุงุฏู ฺฉูู

:::

---

## ฺุฑุง UFS ุงุฎุชุฑุงุน ุดุฏุ

ูุฑุถ ฺฉู ู ุนฺฉุณ ุงุฒ ู ููุธุฑู ุฏุงุฑ (ุงูุฌ ูพุงู). ุญุงูุง ูโุฎูุง ุฑูุด ู ุนูฺฉ ุจฺฉุด. ููุง ุฑู ุฎูุฏ ุนฺฉุณ ุจฺฉุดุ ู ฺฉุงุบุฐ ุดูุงู ูโุฐุงุฑ ุฑูุด (ูุงู ุฌุฏุฏ) ู ููุท ุนูฺฉ ุฑู ุงููุฌุง ูโฺฉุด. ุนฺฉุณ ุงุตู ุณุงูู ูโูููู. ุงฺฏู ุงุฒ ููุงุดุช ุฎูุดุช ูููุฏุ ฺฉุงุบุฐ ุดูุงู ุฑู ูฺฉู ู ุงุฒ ุงูู ุดุฑูุน ูโฺฉู. ุงู ุฏููุง ูููู ฺฉุงุฑู ฺฉู ุฏุงฺฉุฑ ุจุง ูุงูโุณุณุชูุด ูโฺฉูู.

ุนูุช ุงูฺฉู ุงู ุงุณู ุจุฑุงุด ุงูุชุฎุงุจ ุดุฏู ูุงุฏ ฺูุฏุชุง ูุงู ุณุณุชู ุฑู ุจูู ูุตู ูฺฉูู ู ู ูุงู ุณุณุชู ูุงุญุฏ ูุณุงุฒู. ุนู ฺูุฏุชุง ูพูุดู ุง ุฏุงุฑฺฉุชูุฑ ฺฉู ููฺฉูู ุชู ุฌุงูุง ูุฎุชูู ุจุงุดู ุฑู ูโฺุณุจููู ฺฉูุงุฑ ูู ุทูุฑ ฺฉู ุงูฺฏุงุฑ ู ุฏููู ูพูุดู ูุณุชู. ุจุดุชุฑ ุงุฒ ุงูฺฉู ุฎูุฏุด ุณุณุชู ูุงู ุจุงุดูุ ู ุฑูุด ูุตู ฺฉุฑุฏู ู ููุงุด ูุงูโูุง ุฑู ูู ูุณุช. ุจุดุชุฑู ฺฉุงุฑุจุฑุฏุด ุชู ุฏุงฺฉุฑ ูุณุชุด. ูุฑ ุฎุท ุฏุฑ Dockerfile ู ูุงู ุงุฒ ูุงู ุณุณุชู ูุณุงุฒู ฺฉู ุงู ูุงู readable ููุท ูุณุชุด. ุนูุช ุงุตู ฺฉู ุงู ฺฉุงุฑู ูฺฉูู ุจุฑุง ฺฉุดูฺฏ ูุณุชุด. ูุซูุง ุจุชููู base image ุฑู ุชู ุฏุงฺฉุฑ ูุงู ูุง ูุฎุชูู ฺฉุด ฺฉูู

ุญุงูุง ูุฑ ูููุน ูุง ู ุฏุงฺฉุฑ ูุงู ุฑู ุฑุงู ูฺฉูู ู writable layer ุฑู ููู  ูุงู ูุง ุงุถุงูู ูฺฉูู ุชุง ฺุฒูุง ฺฉู ูุฎูุงู ุจููุณู ูุซูุง ูุงฺฏ ุง ุชุบุฑุงุช ุฏุชุงุจุณ ุชู ุงู ูุงู ููุดุชู ูุดู

โ **ฺฉุดูฺฏ (caching)**  
โ **ุงุณุชูุงุฏู ูุฌุฏุฏ ุงุฒ base image ุชู ูพุฑูฺูโูุง ูุฎุชูู**  
โ **ุณุงุฎุช incremental ู ุณุฑุนโุชุฑ**

---

## ููุช ฺฉุงูุชูุฑ ุงุฌุฑุง ูโุดู ฺ ูโุดูุ

ููุช ู ุงูุฌ ุฑู ุจุง `docker run` ุงุฌุฑุง ูโฺฉู:

- ู ูุงูโ ุฌุฏุฏ writable ุจู ุตูุฑุช ูููุช ุฑู ูููโ ูุงูโูุง ูุจู ุณูุงุฑ ูโุดู
- ูุฑ ฺุฒ ฺฉู ุชู ฺฉุงูุชูุฑ ุชุบุฑ ฺฉูู (ูุซูุงู ูุงฺฏโูุงุ ูุงูโูุง ฺฉู ุจุฑูุงูู ูโููุณู)ุ ููุท ุชู ููู ูุงู writable ุฐุฎุฑู ูโุดู
- ูุงูโูุง ูพุงูโุชุฑ read-only ุจุงู ูโูููู
- ุจู ุงู ุณุจฺฉ ูโฺฏู **Copy-on-Write** โ ุงฺฏู ู ูุงู ุชุบุฑ ฺฉููุ ูุณุฎูโ ุฌุฏุฏุด ููุท ุชู ูุงู writable ุณุงุฎุชู ูโุดู. ูุซูุง

```javascript
// ูุงู ุงุตู
const baseLayer = {
  name: "Mahdi",
  age: 30,
  city: "Tehran",
};

// ูุงู ููุดุณุช ฺฉู ุงูู ุฎุงูู
const writableLayer = {};

function read(key) {
  // ุงูู ูโฺฏุฑุฏู ุชู ูุงู ููุดุชู
  if (key in writableLayer) {
    return writableLayer[key];
  }
  // ุงฺฏู ูุจูุฏุ ูโุฑู ุชู ูุงู ุจุณ
  return baseLayer[key];
}

function write(key, value) {
  writableLayer[key] = value;
}

console.log(read("city")); // Tehran

write("city", "Mashhad");

console.log(read("city")); // Mashhad

console.log(baseLayer.city); // Tehranุ ูููุฒ ุชุบุฑ ูฺฉุฑุฏู
```

ูุฑุถ ฺฉู ุฏุงุฎู ฺฉุงูุชูุฑ ูุฑ ู ุงู ฺฉุงุฑู ูโฺฉู:

```
rm -rf node_modules
npm install lodash
```

ุฎุจ ุงูุงู ฺ ุดุฏุ

- ุง`node_modules` ฺฉู ุชู ูุงู ููุทโุฎูุงูุฏู ุจูุฏุ ููโุชููู ูุณุชูู ุญุฐู ุดู. ูพุณ ุฏุงฺฉุฑ ู **ุนูุงูุช ุญุฐู (whiteout)** ุชู ูุงู writable ูโุฐุงุฑู ฺฉู ุจฺฏู ุงู ุฏฺฏู ูุฌูุฏ ูุฏุงุฑู.
- ุจุนุฏ `npm install lodash` ุงุฌุฑุง ูโุดู ู `lodash` ุชู ูุงู writable ูุตุจ ูโุดู.

**ููุท ุงู ุชุบุฑุงุช (ุญุฐู + ูุตุจ ุฌุฏุฏ)** ุชู ูุงู writable ุฐุฎุฑู ูโุดู. ูู ุจูู ฺุฒุง.

ูฺฉุชู ุฌุงูุจ ุงูู ฺฉู ุงฺฏู lodash ุฑู ูพุงฺฉ ฺฉู ุงูู ุงุฒ ุฑู writable layer ูพุงฺฉ ููุดู ุตุฑูุง ู ูุงู ุฌุฏุฏ ุฏฺฏู ุงุถุงูู ูุดู ฺฉู ุฏุงุฎูุด ุนูุงูุช ุฎูุฑุฏู ุจู ุนููุงู ุญุฐู ุดุฏู. UFS ู ุฌูุฑุง ูุซู ุงูู ฺฉู ุฏุงุฑ **ุงุฒ ูุฑ ูุฑุญูู ู ุงุณููพโุดุงุช (snapshot)** ูโฺฏุฑ. ูู ูฺฉุชู ููู ุงูู ฺฉู ุงู ุงุณููพโุดุงุชโูุง ููุท ุงุถุงูู ูโุดูุ ฺฉู ููโุดูุ ูฺฏู ุงูฺฉู ุงูุฌ ุฑู ุฏูุจุงุฑู ุจุณุงุฒ. ูุซูุงู ุงฺฏู ู ฺุฒ ุฑู add ฺฉู ุจุนุฏ ูพุงฺฉุด ฺฉูุ **ุณุงุฒ ฺฉู ููโุดู** ฺูู ุงูู ูุงู ูููุฒ ุชู ูุงูโูุง ูพุงูโุชุฑ ูุณุชุ ููุท ุงุฒ ุฏุฏ ูุง hide ุดุฏู.

:::tip

ููุช ุฏุงุฑ ู ุงูุฌ ุฏุงฺฉุฑ ูโุณุงุฒุ ููู ูุงูโูุง ุฏุฑ ููุงุช ููุทโุฎูุงูุฏู ูุณุชู ู ูฺ ูุงู ููุดุชู ุฏุงุฆู ูุฌูุฏ ูุฏุงุฑู. ูุฑ ุฏุณุชูุฑ ุชู Dockerfile ูุซู `COPY` ุง `RUN` ุจุงุนุซ ูโุดู ู ูุงู ุฌุฏุฏ ุณุงุฎุชู ุจุดู ฺฉู ุชุบุฑุงุชุด ููุทโุฎูุงูุฏู ุฐุฎุฑู ูโุดู. ูู ููุช ูโุฑุณู ุจู ุฏุณุชูุฑูุง ูุซู `RUN npm install` ฺฉู ุจุงุฏ ูุงู ุจุณุงุฒู ุง ุชุบุฑ ุจุฏูุ ุฏุงฺฉุฑ ู ฺฉุงูุชูุฑ ูููุช ุจุง ู ูุงู ููุดุชู ุงุฌุงุฏ ูโฺฉูู ู ุงูู ุฏุณุชูุฑ ุชู ุงู ูุญุท ุงุฌุฑุง ูโุดู. ุจุนุฏุด ุฎุฑูุฌโุด ุฑู ุจู ู ูุงู ููุทโุฎูุงูุฏู ุชุจุฏู ูโฺฉูู ู ุฐุฎุฑู ูโฺฉูู. ูพุณ ุนู ุฏุฑ ุฒูุงู build ููู ฺุฒ ููุทโุฎูุงูุฏููุ ูู ุฏุงฺฉุฑ ุจูุช ุงุฌุงุฒู ูโุฏู ูุฑ ูุฑุญูู ุฑู ุชู ู ูุถุง writable ูููุช ุงุฌุฑุง ฺฉู.  
ููฺูู ุฏุงฺฉุฑ ุจุฑุง ุงูฺฉู ูุฑุงุญู ุณุงุฎุช ุณุฑุนโุชุฑ ุจุดูุ ูุด ูุงูโูุง ุฑู ฺฺฉ ูโฺฉูู ู ุงฺฏู ฺุฒ ุชุบุฑ ูฺฉุฑุฏู ุจุงุดูุ ูุงูโูุง ุฑู ฺฉุด ูโฺฉูู ุชุง ุฏูุจุงุฑู ูุณุงุฒู. ุงู ุจุงุนุซ ูโุดู ููุท ููุช ูุงุฒู ุจุงุดูุ ูุงู ุฏูุจุงุฑู ุณุงุฎุชู ุจุดู ูฺฏุฑูู ุณุฑุนุชุฑ ฺฉุงุฑ ูพุด ุจุฑู.
:::

ุฏุฑ ุงูุชูุง ูุฑ ูุงู ุชุบุฑุงุช ุฑู ูุงู ูุจููุ ุงู ุจุงุนุซ ุงุดุชุฑุงฺฉ ูุงูโูุง ู ุตุฑููโุฌู ุฏุฑ ูุถุง ูโุดู ูู ุงฺฏู ูุงู ูุจู ุชุบุฑ ฺฉูู ุชูุงู ูุงู ูุง ุจุนุฏ ูู ุฏูุจุงุฑู ุณุงุฎุชู ูุดู

---

## ๐ฆ ูุซุงู ูุงูุน ุจุง Dockerfile

```yaml

# Base layer
FROM node:18

# ูุงู ุฏูู - ูุงูโูุง ุฑู ฺฉูพ ูโฺฉูู
COPY . /app

# ูุงู ุณูู - npm install
RUN cd /app && npm install

# ูุงู ฺูุงุฑู - ุงุฌุฑุง ุจุฑูุงูู
CMD ["node", "/app/index.js"]

```

ููุช ุงู ุงูุฌ build ุจุดู:

```javascript
Layer 1 โ "node:18 image (ุณุณุชู ูพุงู + Node.js)"
Layer 2 โ "ูุงูโูุง ูพุฑูฺู ุชู ูุณุฑ /app"
Layer 3 โ "node_modules ู ุฎุฑูุฌ npm install"
Layer 4 โ "ููุท ู ุฏุณุชูุฑ ุงุฌุฑุง ูุณุชุ ุชู ูุงู ุญุณุงุจ ูโุดู"
```

ุญุงูุง ููุช ุจุง ุงู ุงูุฌ ฺฉุงูุชูุฑ ุงุฌุฑุง ูโฺฉู:

```
docker run my-app-image
```

โ ู **ูุงูโ writable ูููุช** ูู ุฑู ูููโ ุงู ูุงูโูุง ุณูุงุฑ ูโุดู.  
ูุฑ ฺุฒ ฺฉู ุชู `/app/logs` ุง ุฏุชุงุจุณ ูููุช ุณุงุฎุชู ุดูุ ููุท ุงูู ุจุงูุง ุฐุฎุฑู ูโุดู.

---

```yaml
FROM node:18
# ุงูุฌุง ุงฺฏู ููุท ฺฉุฏ ูุง ฺฉ ุญุฑู ุนูุถ ุจุดู ฺฉู ูุงู ูุง ุจุนุฏ ุจุงุฏ ุฏูุจุงุฑู ุญุณุงุจ ุจุดู
COPY . /app

WORKDIR /app

RUN npm install

CMD ["node", "index.js"]
```

```yaml
FROM node:18

WORKDIR /app

# ููุท ูุงูโูุง ูุงุฒู ุจุฑุง ูุตุจ ูพฺฉุฌโูุง ุฑู ุงูู ฺฉูพ ูโฺฉูู
COPY package*.json ./

# ุงูุฌุง ุฒูุงู ูพฺฉุฌ ูุง ูุตุจ ูุดู ฺฉู ุฏูุชุง ูุงู ูุจู ุนูุถ ุดุฏู ุจุงุดู
RUN npm install

# ุญุงูุง ุจูู ูุงูโูุง ูพุฑูฺู ุฑู ฺฉูพ ูโฺฉูู
COPY . .

CMD ["node", "index.js"]
```

ู ุงูฺฉู ูุฑู ufs ู volume ุฏุฑ ุงูู ฺฉู ูุงููู ุงุตูุง ูุงุฑุฏ UFS ููโุดูุ ฺูู ุฎุงุฑุฌ ุงุฒ ุงูุฌู ู ููุท mount ูุดู
