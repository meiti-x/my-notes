<!doctype html>
<html lang="fa" dir="rtl" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-نرم‌افزار/دیتابیس/کافکا/kafka" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">kafka | یادداشت های من</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/meiti-x.png"><meta data-rh="true" name="twitter:image" content="https://github.com/meiti-x.png"><meta data-rh="true" property="og:url" content="https://meiti-x.github.io/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka"><meta data-rh="true" property="og:locale" content="fa"><meta data-rh="true" name="docusaurus_locale" content="fa"><meta data-rh="true" name="docsearch:language" content="fa"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="kafka | یادداشت های من"><meta data-rh="true" name="description" content="کافکا توی داکیومنت هاش خودش رو پلتفرم دیستربیوت استریم معرفی کرده. اینکه از message broker استفاده کنیم خوبیش loose coupling بین لایه های مختلفه"><meta data-rh="true" property="og:description" content="کافکا توی داکیومنت هاش خودش رو پلتفرم دیستربیوت استریم معرفی کرده. اینکه از message broker استفاده کنیم خوبیش loose coupling بین لایه های مختلفه"><link data-rh="true" rel="icon" href="/my-notes/img/docusaurus.png"><link data-rh="true" rel="canonical" href="https://meiti-x.github.io/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka"><link data-rh="true" rel="alternate" href="https://meiti-x.github.io/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka" hreflang="fa"><link data-rh="true" rel="alternate" href="https://meiti-x.github.io/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"kafka","item":"https://meiti-x.github.io/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka"}]}</script><link rel="alternate" type="application/rss+xml" href="/my-notes/blog/rss.xml" title="یادداشت های من RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-notes/blog/atom.xml" title="یادداشت های من Atom Feed">




<link rel="icon" href="/my-notes/img/docusaurus.png">
<link rel="manifest" href="/my-notes/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)"><link rel="stylesheet" href="/my-notes/assets/css/styles.f20f4f92.css">
<script src="/my-notes/assets/js/runtime~main.68b0a04d.js" defer="defer"></script>
<script src="/my-notes/assets/js/main.a5e89928.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="پرش به مطلب اصلی"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">پرش به مطلب اصلی</a></div><nav aria-label="صفحه اصلی" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="باز و بست منو" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-notes/"><b class="navbar__title text--truncate">صفحه اصلی</b></a><a class="navbar__item navbar__link" href="/my-notes/docs/intro">مستندات</a><a class="navbar__item navbar__link" href="/my-notes/docs/tags">تگ ها</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/meiti-x" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="بین حالت تاریک و روشن سوئیچ کنید (الان system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="بازگشت به بالا" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="نوار کناری مستندات" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-notes/docs/draft/Untitled">draft</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-notes/docs/intro">مقدمه</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-notes/docs/عمومی/اجتماعی/امپریالیسم">عمومی</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/my-notes/docs/نرم‌افزار/دیتابیس/ACID">نرم‌افزار</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/ACID">دیتابیس</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/ACID">ACID</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/BASE">BASE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Batch_Process">Batch_Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/CAP">CAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Cursor">Cursor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Denormalization">Denormalization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Engine">Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Index_DB">Index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Isolation_Level">Isolation Level</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Materlized_view">Materlized_view</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/N+1">N+1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Partitioning">Partitioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Replica">Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Shard">Shard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/Tips">Tips</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/ردیس/Pipeline">ردیس</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka">کافکا</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/my-notes/docs/نرم‌افزار/دیتابیس/کافکا/kafka">kafka</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/my-notes/docs/نرم‌افزار/سیستم‌دیزاین/Bloom_Filters">سیستم‌دیزاین</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/my-notes/docs/نرم‌افزار/سیستم‌عامل/Brust_time">سیستم‌عامل</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/my-notes/docs/نرم‌افزار/عمومی/Availability">عمومی</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="نشانگر صفحات"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="صفحه اصلی" class="breadcrumbs__link" href="/my-notes/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">نرم‌افزار</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">دیتابیس</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">کافکا</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">kafka</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">مطالب این صفحه</button></div><div class="theme-doc-markdown markdown"><header><h1>kafka</h1></header><p>کافکا توی داکیومنت هاش خودش رو پلتفرم دیستربیوت استریم معرفی کرده. اینکه از message broker استفاده کنیم خوبیش loose coupling بین لایه های مختلفه</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="انواع-دلیوری-پیام-در-کافکا">انواع دلیوری پیام در کافکا<a href="#انواع-دلیوری-پیام-در-کافکا" class="hash-link" aria-label="لینک مستقیم به انواع دلیوری پیام در کافکا" title="لینک مستقیم به انواع دلیوری پیام در کافکا">​</a></h2>
<ul>
<li>مدل at most once: یعنی یکبار پیام ارسال میشه و retry نداره و اگه از دست بره برای همیشه از دست میره مثلا برای فرستادن لاگ ویو صفحه خوبه</li>
<li>مدل at least once: توی این مدل پیام بعد از دریافت توسط consumer کامیت میشه و بعدش پیام پردازش میشه توی این حالت retry داریم برای پیام های که هنوز کامیت نشدن</li>
<li>مدل exactly once: توی حالت at least once اگه پیام کامیت بشه ولی وسط پردازش کرش کنه اون پیام چون کامیت شده دیگه retry نمیشه ولی توی این حالت بعد از پردازش کامییت میشه پس وقتی کامییت میشه یعنی پردازشش هم تموم شده. یعنی مثلا من یه ایونت میفرستم، پردازشم شروع میشه یه پیام توی یه جایی که برای خوده کافکا است پابلیش میشه بعد اینکه کارم تموم شد کامییت که کردم میره داخل همون جایی که برای کافکا بود میکه کارش تموم شد این ایونت و اگه fail بشه کافکا پاکش میکنه</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>یادداشت</div><div class="admonitionContent_BuS1"><p><strong>وقتی پیام پابلیش میشه چه اتفاقاتی میافته؟</strong>
وقتی یک پیام در Kafka publish می‌شود، producer اول تصمیم می‌گیرد که پیام باید روی کدام partition برود. این انتخاب یا بر اساس key انجام می‌شود یا اگر key نداشته باشد، با round-robin یا الگوریتم دیگر. بعد از مشخص شدن partition، producer پیام را برای leader broker آن partition می‌فرستد.</p><p>broker پیام را به انتهای log مربوط به آن partition اضافه می‌کند. این log یک فایل append-only روی دیسک است که به صورت segment تقسیم شده. داده بلافاصله در حافظه سیستم‌عامل (page cache) ذخیره می‌شود و بعد به صورت پس‌زمینه روی دیسک flush می‌شود، به همین دلیل هم Kafka خیلی سریع عمل می‌کند.</p><p>بعد از نوشتن پیام، leader آن را برای replicaهای follower ارسال می‌کند تا کپی‌ها به‌روز شوند. بسته به تنظیمات producer، ممکن است منتظر تأیید همه replicaها بماند یا فقط منتظر تأیید leader باشد. زمانی که شرط acks برآورده شد، leader یک acknowledgment به producer می‌فرستد که شامل offset پیام در log هم هست.</p><p>از این لحظه پیام رسماً در Kafka ذخیره شده و آماده مصرف است. consumerها با استفاده از offsetها پیام را از log می‌خوانند. Kafka پیام را تا زمانی که retention policy اجازه دهد نگه می‌دارد، حتی اگر همه consumerها آن را خوانده باشند.</p><p>به این ترتیب، publish یک پیام در Kafka زنجیره‌ای از انتخاب partition، append شدن روی log، replication بین brokerها و در نهایت برگرداندن acknowledgment به producer است.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="broker">Broker<a href="#broker" class="hash-link" aria-label="لینک مستقیم به Broker" title="لینک مستقیم به Broker">​</a></h2>
<p>اBrokerها در واقع سرورهای Kafka هستن که داده‌ها رو نگه می‌دارن و مدیریت می‌کنن. هر broker می‌تونه چند topic و partition رو میزبانی کنه. وقتی من پیام می‌فرستم، broker وظیفه داره پیام رو ذخیره کنه، replicate کنه و در دسترس بقیه consumerها بذاره. وقتی cluster از چند broker تشکیل می‌شه، هر broker با بقیه هماهنگ می‌کنه تا اگه یکی از کار افتاد، داده‌ها همچنان در دسترس باشن. این replication باعث می‌شه Kafka خیلی مقاوم و fault-tolerant باشه.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="topics">Topics<a href="#topics" class="hash-link" aria-label="لینک مستقیم به Topics" title="لینک مستقیم به Topics">​</a></h2>
<p>تاپیک مثل یه کانال یا دسته‌بنده‌ست که پیام‌ها رو بر اساس موضوع جدا می‌کنه. فرض کن می‌خوای لاگ‌های صفحه، سفارش‌های خرید و هشدارهای سیستم رو جدا ذخیره کنی، هر کدوم یه topic می‌شن. من وقتی پیام می‌فرستم، مشخص می‌کنم به کدوم topic بره. consumerها هم می‌تونن subscribe کنن به topic دلخواه و فقط پیام‌های مربوطه رو بخونن. Topic در واقع یک نام منطقیه که پیام‌ها رو گروه‌بندی می‌کنه، ولی خودش داده رو ذخیره نمی‌کنه—این partitionها هستن که نگهداری می‌کنن.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="partitions">Partitions<a href="#partitions" class="hash-link" aria-label="لینک مستقیم به Partitions" title="لینک مستقیم به Partitions">​</a></h2>
<p>هر topic می‌تونه به چند partition تقسیم بشه تا همزمان پردازش سریع‌تر بشه و مقیاس‌پذیر باشه. Partition مثل یه خط زمانیه، هر پیام که می‌فرستم میره ته این خط و یه offset یکتا می‌گیره. هر partition یه <strong>leader</strong> داره و followerها اون partition رو replicate می‌کنن. این ساختار باعث می‌شه که حتی وقتی پیام‌ها خیلی زیاد شدن یا brokerها crash کردن، دسترسی به داده‌ها از بین نره. partition همچنین امکان parallelism رو فراهم می‌کنه: چند consumer می‌تونن همزمان روی partitionهای مختلف پیام‌ها رو پردازش کنن.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-commit-log">The Commit Log<a href="#the-commit-log" class="hash-link" aria-label="لینک مستقیم به The Commit Log" title="لینک مستقیم به The Commit Log">​</a></h2>
<p>کامیت لاگ همون دنباله پیام‌های append-only هست که هر partition داره. وقتی پیام publish می‌شه، میره ته log و offset یکتا می‌گیره. log تضمین می‌کنه که پیام‌ها همیشه پشت سر هم و با ترتیب درست ذخیره می‌شن. Consumerها بر اساس offset می‌تونن پیام‌ها رو بخونن و حتی بعد از چند روز یا هفته دوباره برگردن پیام‌ها رو مرور کنن. Kafka هیچ پیام رو حذف نمی‌کنه تا وقتی که retention policy اجازه بده، حتی اگر همه consumerها پیام رو خونده باشن. این log همچنین پایه‌ایه برای replication، recovery و exactly-once semantics، چون همه داده‌ها مرتب و قابل دسترس باقی می‌مونن.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>یادداشت</div><div class="admonitionContent_BuS1"><p>Retention policy توی Kafka همون قانونی هست که مشخص می‌کنه <strong>پیام‌ها تا چه مدت یا تا چه حجمی توی topic نگه داشته بشن</strong>. یعنی Kafka خودش به صورت خودکار بعد از یه مدتی یا وقتی حجم log به حد مشخص رسید، پیام‌های قدیمی رو پاک می‌کنه تا حافظه پر نشه.</p><p>می‌تونه بر اساس <strong>زمان</strong> باشه، مثلاً پیام‌ها ۷ روز نگه داشته بشن، یا بر اساس <strong>حجم</strong>، مثلاً وقتی log یه partition به ۱۰ گیگ رسید، پیام‌های قدیمی شروع به حذف شدن می‌کنن. این سیاست باعث می‌شه حافظه و دیسک broker پر نشه و عملکرد Kafka ثابت بمونه.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="نکات-طراحی-producer">نکات طراحی Producer<a href="#نکات-طراحی-producer" class="hash-link" aria-label="لینک مستقیم به نکات طراحی Producer" title="لینک مستقیم به نکات طراحی Producer">​</a></h2>
<p>پرودیسر مسئول اینه که پیام‌ها رو به Kafka بفرسته. هر تصمیمی که اینجا می‌گیریم، مستقیم روی <strong>سرعت و اطمینان ورود داده‌ها</strong> تاثیر داره.</p>
<p><strong>الف) امنیت و دوام داده‌ها</strong><br>
<!-- -->برای اینکه داده‌ها گم نشن یا درست ثبت بشن، مهم‌ترین گزینه <code>acks</code> هست:</p>
<ul>
<li>
<p>ا<code>acks=all</code> یا <code>acks=-1</code>: بیشترین امنیت، منتظر میمونه تا همه replicaهای فعال پیام رو تایید کنن. عالیه برای داده‌های مهم مثل لاگ‌های حساس ولی کمی کندتره.</p>
</li>
<li>
<p>ا<code>acks=0</code>: سریع‌ترین حالت، هیچ تاییدی نمی‌خواد ولی ممکنه داده گم بشه. فقط وقتی مهم نیست داده‌ها از دست برن استفاده می‌کنیم (مثلاً page view تو وب).</p>
</li>
</ul>
<p><strong>Retries و Idempotence:</strong></p>
<ul>
<li>ا<strong>Retries:</strong> اگه شبکه یه لحظه قطع شد، producer خودش تلاش می‌کنه دوباره بفرسته.</li>
</ul>
<p>-ا <strong>Idempotence:</strong> با فعال کردن <code>enable.idempotence=true</code>، اگه پیام دوباره فرستاده بشه، فقط یکبار ثبت میشه و از Duplicate جلوگیری می‌کنه.</p>
<hr>
<p><strong>ب) ترتیب پیام‌ها و همزمانی</strong><br>
<!-- -->اگه ترتیب پیام‌ها مهم باشه (مثل سیستم‌های audit یا تراکنش):</p>
<ul>
<li>باید <code>max.in.flight.requests.per.connection=1</code> و <code>acks=all</code> باشه تا پیام‌های بعدی قبل از تایید پیام قبلی ارسال نشن.</li>
</ul>
<hr>
<p><strong>ج) گروه‌بندی و مسیر‌دهی داده‌ها</strong></p>
<p>-ا <strong>Keying:</strong> اگه میخوایم پیام‌های مرتبط تو یه partition باشن، از key استفاده می‌کنیم. مثلا stage ID برای alert trend data.</p>
<ul>
<li>ا<strong>Custom Partitioner:</strong> اگه بخوایم کنترل کنیم کدوم partition داده بره، partitioner کلاس می‌سازیم. مثلا همه alertهای مهم برن تو partition 0 تا سریع‌تر پردازش شن.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="نکات-طراحی-consumer">نکات طراحی Consumer<a href="#نکات-طراحی-consumer" class="hash-link" aria-label="لینک مستقیم به نکات طراحی Consumer" title="لینک مستقیم به نکات طراحی Consumer">​</a></h2>
<p>کانسیومر مشخص می‌کنن داده‌ها چجوری خونده، پردازش و دنبال میشن و چه‌قدر اپلیکیشن مقیاس‌پذیر باشه.</p>
<ul>
<li>
<p>ا<strong>Consumer Group (<code>group.id</code>)</strong>: همه consumerهایی که group id مشترک دارن، کار رو بین خودشون تقسیم می‌کنن → throughput بالا.</p>
</li>
<li>
<p>تعداد consumerها نباید بیشتر از partition باشه، وگرنه بعضی idle میشن.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="چرا-کافکا-در-نوشتن-بهینه-است">چرا کافکا در نوشتن بهینه است؟<a href="#چرا-کافکا-در-نوشتن-بهینه-است" class="hash-link" aria-label="لینک مستقیم به چرا کافکا در نوشتن بهینه است؟" title="لینک مستقیم به چرا کافکا در نوشتن بهینه است؟">​</a></h2>
<p>کافکا تو نوشتن خیلی بهینه است چون همیشه پیام‌ها رو <strong>به ته فایل اضافه می‌کنه</strong> و دنبال جاهای خالی یا overwrite نمی‌گرده، این باعث میشه نوشتن روی دیسک خیلی سریع باشه. پیام‌ها رو <strong>دسته‌ای (batch) می‌فرسته و می‌نویسه</strong>، نه یکی‌یکی، بنابراین تعداد عملیات روی دیسک و شبکه کم میشه و CPU کمتر درگیر میشه. وقتی می‌گم Kafka پیام‌ها رو <strong>دسته‌ای (batch) می‌فرسته و می‌نویسه</strong>، منظورم اینه که producer چند تا پیام رو جمع می‌کنه و <strong>یکجا به broker می‌فرسته</strong>. بعد broker این batch رو <strong>اول تو حافظه (page cache سیستم عامل) می‌نویسه</strong> نه مستقیم روی دیسک.</p>
<p>کافکا از تکنیک <strong>zero-copy و page cache سیستم عامل</strong> استفاده می‌کنه، یعنی داده‌ها مستقیم از حافظه فایل سیستم به شبکه میرن بدون کپی اضافه، سرعت بالاتر و مصرف CPU پایین‌تر میشه. همچنین consumerها هم پیام‌ها رو <strong>به ترتیب و پشت سر هم می‌خونن</strong>، که sequential read خیلی سریع‌تر از random read هست. در نهایت، هر topic می‌تونه چند partition داشته باشه و هر partition مثل یه log مستقل عمل می‌کنه، پس نوشتن و خوندن می‌تونه همزمان و موازی انجام بشه. به زبان ساده، Kafka مثل یه خط تولید مرتب و بدون برگشت کار می‌کنه؛ همه چیز تو حافظه و دیسک بهینه پیش میره و throughput خیلی بالاست.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="صفحات مستندات"><a class="pagination-nav__link pagination-nav__link--prev" href="/my-notes/docs/نرم‌افزار/دیتابیس/ردیس/Pipeline"><div class="pagination-nav__sublabel">قبلی</div><div class="pagination-nav__label">Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/my-notes/docs/نرم‌افزار/سیستم‌دیزاین/Bloom_Filters"><div class="pagination-nav__sublabel">بعدی</div><div class="pagination-nav__label">Bloom Filters</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#انواع-دلیوری-پیام-در-کافکا" class="table-of-contents__link toc-highlight">انواع دلیوری پیام در کافکا</a></li><li><a href="#broker" class="table-of-contents__link toc-highlight">Broker</a></li><li><a href="#topics" class="table-of-contents__link toc-highlight">Topics</a></li><li><a href="#partitions" class="table-of-contents__link toc-highlight">Partitions</a></li><li><a href="#the-commit-log" class="table-of-contents__link toc-highlight">The Commit Log</a></li><li><a href="#نکات-طراحی-producer" class="table-of-contents__link toc-highlight">نکات طراحی Producer</a></li><li><a href="#نکات-طراحی-consumer" class="table-of-contents__link toc-highlight">نکات طراحی Consumer</a></li><li><a href="#چرا-کافکا-در-نوشتن-بهینه-است" class="table-of-contents__link toc-highlight">چرا کافکا در نوشتن بهینه است؟</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>